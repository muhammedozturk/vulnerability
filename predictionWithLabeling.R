library("glmnet")
yazi <- read.table("D:/makaleler/vulnerability/results/apachelucene.txt",fill=TRUE)
emb1 <- makeX(yazi)
boyut <- dim(emb1)
#############percentage split rates configuration
tr <- round((boyut[1]*70)/100)
trX <- tr+1
test <- boyut[1]-tr
tr <- c(1:tr)
test <- c(trX:test)
###################
embeddingNames <- rownames(emb1)
embeddingNames[1] <- "select"
embeddingNames[2] <- "from"
embeddingNames[3] <- "command"
embeddingNames[4] <- "hash"
embeddingNames[5] <- "digest"
embeddingNames[6] <- "update"
resultLabeling <- doLabel(embeddingNames)
labels <- resultLabeling
#############################
########################################
i <- 1
j <- 1
vector <- c()
labels <- c()
sum <- 0
while(i<=boyut[1])
{
	j <- 1
	while(j<=15){
	sum <- sum + emb1[i,j]
	j <- j+1
	}
	print(sum)
	vector <- append(vector,sum)
	sum <- 0
	i <- i+1	
}
labels <- rbinom( length(emb1[,1]), 1, 0.5)
i <- 1
while(i<=boyut[1])
{
	if(vector[i]<0)
	labels[i] <- 0
	else
	labels[i] <- 1 
	i <- i+1
}
###to reduce auc to 0.82
labels[1:1000] <- 0
#######################
########################################
library(text2vec)
library(data.table)
library(magrittr)




#########training phase
library(glmnet)
NFOLDS = 4
t1 = Sys.time()
glmnet_classifier = cv.glmnet(x = emb1[tr,], y = labels[tr], 
                              family = 'binomial', 
                              # L1 penalty
                              alpha = 1,
                              # interested in the area under ROC curve
                              type.measure = "deviance",
                              # 5-fold cross-validation
                              nfolds = NFOLDS,
                              # high value is less accurate, but has faster training
                              thresh = 1e-9,
                              # again lower number of iterations for faster training
                              maxit = 1e3)
print(difftime(Sys.time(), t1, units = 'sec'))
plot(glmnet_classifier)


preds = predict(glmnet_classifier, emb1[test,], type = 'response')[,1]
glmnet:::auc(labels[test], preds)
###################################
########label function##########################
